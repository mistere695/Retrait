<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Inscription XM Trading</title>
  <style>
    body { font-family: Arial, sans-serif; max-width:480px; margin:2rem auto; padding:1rem; }
    label { display:block; margin-top:1rem; }
    input, select, button { width:100%; padding:.5rem; margin-top:.3rem; box-sizing:border-box; }
    .phone-group { display:flex; }
    .phone-group .dial-code { width:4.5rem; margin-right:.5rem; }
    button { margin-top:1.5rem; background:#0077cc; color:#fff; border:none; cursor:pointer; }
    button:hover { background:#005fa3; }
    #thankyou { display:none; text-align:center; }
    #thankyou h2 { color: #0077cc; }
  </style>
</head>
<body>
  <h2 id="form-title">Inscription XM Trading</h2>

  <form id="registration-form" name="inscription-xm" method="POST" data-netlify="true" netlify-honeypot="bot-field">
    <input type="hidden" name="form-name" value="inscription-xm">
    <p style="display:none">
      <label>Si vous êtes humain, ne remplissez pas <input name="bot-field"></label>
    </p>

    <label for="nom">Nom :</label>
    <input type="text" id="nom" name="nom" required>

    <label for="prenom">Prénom :</label>
    <input type="text" id="prenom" name="prenom" required>

    <label for="pays">Pays :</label>
    <select id="pays" name="pays" required>
      <!-- ... options comme avant ... -->
    </select>

    <label>Téléphone :</label>
    <div class="phone-group">
      <input type="text" id="dial-code" name="dial-code" class="dial-code" readonly placeholder="+xxx">
      <input type="tel" id="phone" name="phone" required placeholder="Numéro">
    </div>

    <label for="montant">Montant à investir :</label>
    <input type="number" id="montant" name="montant" step="0.01" required>

    <label for="devise">Devise :</label>
    <select id="devise" name="devise" required>
      <option value="USD">$ Dollar</option>
      <option value="XOF">FCFA</option>
      <option value="XAF">Franc Congo</option>
      <option value="HTG">Gourde</option>
      <option value="MGA">Ariary</option>
      <option value="EUR">€ Euro</option>
    </select>

    <label for="age">Âge :</label>
    <input type="number" id="age" name="age" min="18" required>

    <label for="metier">Métier :</label>
    <input type="text" id="metier" name="metier" required>

    <button type="submit">Valider</button>
  </form>

  <!-- zone de remerciement masquée -->
  <div id="thankyou">
    <h2>Félicitations, <span id="thx-nom"></span> !</h2>
    <p>
      Vous avez été enregistré avec succès chez XM Trading pour un investissement de
      <strong><span id="thx-montant"></span> <span id="thx-devise"></span></strong>.<br>
      Contactez votre administrateur sur WhatsApp pour effectuer votre dépôt. <br>
      Une fois le dépôt effectué, le traitement prendra jusqu’à <strong>2 heures</strong> maximum.
    </p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 1) Autoremplissage indicatif
      const codes = {
        /* … tes codes pays … */
        "Bénin":"+229","Burkina Faso":"+226","Cap-Vert":"+238","Côte d'Ivoire":"+225",
        "Gambie":"+220","Ghana":"+233","Guinée":"+224","Guinée-Bissau":"+245",
        "Libéria":"+231","Mali":"+223","Mauritanie":"+222","Niger":"+227",
        "Nigéria":"+234","Sénégal":"+221","Sierra Leone":"+232","Togo":"+228",
        "Cameroun":"+237","Centrafrique":"+236","Tchad":"+235","Congo":"+242",
        "RDC":"+243","Guinée équatoriale":"+240","Gabon":"+241","Sao Tomé-et-Principe":"+239",
        "Haïti":"+509","Madagascar":"+261"
      };
      const paysEl = document.getElementById('pays');
      const dialEl = document.getElementById('dial-code');
      paysEl.addEventListener('change', () => {
        dialEl.value = codes[paysEl.value] || '';
      });

      // 2) Interception et envoi via fetch()
      const form = document.getElementById('registration-form');
      form.addEventListener('submit', async e => {
        e.preventDefault();

        // Construire FormData (inclut le hidden form-name et honeypot)
        const formData = new FormData(form);

        try {
          // Envoi à Netlify Forms
          await fetch('/', { method: 'POST', body: formData });

          // Récupérer les valeurs pour le message
          const prenom = formData.get('prenom');
          const nom    = formData.get('nom');
          const montant= formData.get('montant');
          const devise = formData.get('devise');

          // Afficher le message de remerciement
          document.getElementById('form-title').style.display = 'none';
          form.style.display = 'none';
          document.getElementById('thx-nom').innerText     = prenom + ' ' + nom;
          document.getElementById('thx-montant').innerText = parseFloat(montant).toLocaleString();
          document.getElementById('thx-devise').innerText  = devise;
          document.getElementById('thankyou').style.display = 'block';
        } catch (err) {
          alert("Erreur lors de l'envoi, veuillez réessayer.");
          console.error(err);
        }
      });
    });
  </script>
</body>
</html>